<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>Calgary Open Data GraphQL API | Louis&#39; Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Facebook recently announced GraphQL, a query language for building APIs. The strength of this new language has to do with the fact that you can request all the required data in one query, instead of h">
<meta property="og:type" content="article">
<meta property="og:title" content="Calgary Open Data GraphQL API">
<meta property="og:url" content="http://www.louisbourque.ca/blog/2016/09/graphql/index.html">
<meta property="og:site_name" content="Louis' Blog">
<meta property="og:description" content="Facebook recently announced GraphQL, a query language for building APIs. The strength of this new language has to do with the fact that you can request all the required data in one query, instead of h">
<meta property="og:updated_time" content="2016-09-27T00:26:35.234Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Calgary Open Data GraphQL API">
<meta name="twitter:description" content="Facebook recently announced GraphQL, a query language for building APIs. The strength of this new language has to do with the fact that you can request all the required data in one query, instead of h">
<meta name="twitter:creator" content="@louisbourque">
  
    <link rel="alternate" href="/blog/atom.xml" title="Louis&#39; Blog" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  <link rel="stylesheet" href="/blog/css/styles.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-27120534-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class=""
                 href="/blog/../">Home</a></li>
        
          <li><a class=""
                 href="/blog/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/blog/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">Louis&#39; Blog</h1>
  
    <p class="lead blog-description">All about software development for the web</p>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          <article id="post-graphql" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      Calgary Open Data GraphQL API
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/blog/2016/09/graphql/" class="article-date"><time datetime="2016-09-26T22:37:00.000Z" itemprop="datePublished">September 26th, 2016</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>Facebook recently announced <a href="http://graphql.org/" target="_blank" rel="external">GraphQL</a>, a query language for building APIs. The strength of this new language has to do with the fact that you can request all the required data in one query, instead of having to make multiple requests. Writing queries is intuitive and the structure of the results mirrors the structure of the query.</p>
<p>GraphiQL was also created to allow developers to interact with the API they’re developing. It has autocomplete and built in documentation which are incredibly useful.</p>
<p>I wanted to create an API using this new language to see how it works and explore the possibilities. You can <a href="https://opendata-graphql.herokuapp.com/graphql" target="_blank" rel="external">interact with this API here</a></p>
<h2 id="Building-an-API"><a href="#Building-an-API" class="headerlink" title="Building an API"></a>Building an API</h2><p>The first step was creating a hello world query. First, <code>GraphQLObjectType</code> is used to create a Query, and the following is passed as a field:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">hello: &#123;</div><div class="line">  type: GraphQLString,</div><div class="line">  resolve: () =&gt; &apos;world&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The <code>type</code> field describes the type of result returned. It can be a basic type like string, int, or Boolean. It can also be a custom type, which we’ll see later.</p>
<p>The <code>resolve</code> field is a function which generates the result. In the example above, the result will always be “world”.</p>
<p>If we run the following query in <a href="https://opendata-graphql.herokuapp.com/graphql?query=query%7B%0A  hello%0A%7D" target="_blank" rel="external">GraphiQL</a>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">query&#123;</div><div class="line">  hello</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>We will get the following result:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;data&quot;: &#123;</div><div class="line">    &quot;hello&quot;: &quot;world&quot;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Passing-Parameters-to-GraphQL"><a href="#Passing-Parameters-to-GraphQL" class="headerlink" title="Passing Parameters to GraphQL"></a>Passing Parameters to GraphQL</h2><p>Then I tried to create something a little more dynamic, and I created an add function. By adding arguments to the query and resolve function, you can use those arguments in the generation of our results</p>
<p>The following example shows how we can pass two integers to an <code>add</code> function, and return the sum.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">add: &#123;</div><div class="line">      type: GraphQLInt,</div><div class="line">      args:&#123;</div><div class="line">        a:&#123;</div><div class="line">          name:&apos;a&apos;,</div><div class="line">          type: GraphQLInt</div><div class="line">        &#125;,</div><div class="line">        b:&#123;</div><div class="line">          name:&apos;b&apos;,</div><div class="line">          type: GraphQLInt</div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      resolve: (root,&#123;a,b&#125;) =&gt; a+b</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>The <code>type</code> field again describes the type of result returned. In this case we’re now returning an integer.</p>
<p>The <code>args</code> field is an object with properties which can be passed to the resolve function via the query. In this case we’re passing two integers, <code>a</code> and <code>b</code>.</p>
<p>The <code>resolve</code> field again is a function which generates the result. In this example, the result is the sum of a and b. The parameters are passed as a single object.</p>
<p>If we run the following query in <a href="https://opendata-graphql.herokuapp.com/graphql?query=query%7B%0A%20%20add%28a%3A3%2Cb%3A7%29%0A%7D" target="_blank" rel="external">GraphiQL</a>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">query&#123;</div><div class="line">  add(a:3,b:7)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>We will get the following result:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  &quot;data&quot;: &#123;</div><div class="line">    &quot;add&quot;: 10</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Querying-a-PostgreSQL-database-in-GraphQL"><a href="#Querying-a-PostgreSQL-database-in-GraphQL" class="headerlink" title="Querying a PostgreSQL database in GraphQL"></a>Querying a PostgreSQL database in GraphQL</h2><p>The previous examples were great for getting to know the basics, but if we want our API to be useful, it will have to inteact with data in more elaborate ways. Using some data from the <a href="https://data.calgary.ca/OpenData/Pages/DatasetListingAlphabetical.aspx" target="_blank" rel="external">City of Calgary Open Data Catalogue</a> I created a PostgreSQL database, and used GraphQL to interact with it.</p>
<p>The Query definition is a bit longer, but follows the same basic structure. I simply added many fields allowing to filter the data:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">fireStations: &#123;</div><div class="line">  type: new GraphQLList(fireStationType),</div><div class="line">  args: &#123;</div><div class="line">    nameContains: &#123;</div><div class="line">      name: &apos;nameContains&apos;,</div><div class="line">      type: GraphQLString</div><div class="line">    &#125;,</div><div class="line">    addressContains: &#123;</div><div class="line">      name: &apos;addressContains&apos;,</div><div class="line">      type: GraphQLString</div><div class="line">    &#125;,</div><div class="line">    hasFireSupport: &#123;</div><div class="line">      name: &apos;hasFireSupport&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasMedRescue: &#123;</div><div class="line">      name: &apos;hasMedRescue&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasAquaRescue: &#123;</div><div class="line">      name: &apos;hasAquaRescue&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasHighAngRes: &#123;</div><div class="line">      name: &apos;hasHighAngRes&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasHazCond: &#123;</div><div class="line">      name: &apos;hasHazCond&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasAirportRes: &#123;</div><div class="line">      name: &apos;hasAirportRes&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasHeavyRes: &#123;</div><div class="line">      name: &apos;hasHeavyRes&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasPubSrvAsst: &#123;</div><div class="line">      name: &apos;hasPubSrvAsst&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasFalseAlarm: &#123;</div><div class="line">      name: &apos;hasFalseAlarm&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasHydBldInsp: &#123;</div><div class="line">      name: &apos;hasHydBldInsp&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasInvestigat: &#123;</div><div class="line">      name: &apos;hasInvestigat&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasH20_Safety: &#123;</div><div class="line">      name: &apos;hasH20_Safety&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasChemDrop: &#123;</div><div class="line">      name: &apos;hasChemDrop&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasSmokeDProg: &#123;</div><div class="line">      name: &apos;hasSmokeDProg&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasStnTours: &#123;</div><div class="line">      name: &apos;hasStnTours&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasSandWinter: &#123;</div><div class="line">      name: &apos;hasSandWinter&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;,</div><div class="line">    hasBulkWater: &#123;</div><div class="line">      name: &apos;hasBulkWater&apos;,</div><div class="line">      type: GraphQLBoolean</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  resolve: resolvefireStations</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>The <code>type</code> field now returns a list of objects, and those objects are a custom type <code>fireStationType</code>. The type is defined as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">const fireStationType = new GraphQLObjectType(&#123;</div><div class="line">  name: &apos;FireStation&apos;,</div><div class="line">  description: &apos;A Fire Station&apos;,</div><div class="line">  fields: () =&gt; (&#123;</div><div class="line">    name: &#123;</div><div class="line">      type: GraphQLString,</div><div class="line">      description: &apos;Station Name&apos;,</div><div class="line">    &#125;,</div><div class="line">    address: &#123;</div><div class="line">      type: GraphQLString,</div><div class="line">      description: &apos;Station Address&apos;</div><div class="line">    &#125;,</div><div class="line">    firesupp: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Fire Support&apos;</div><div class="line">    &#125;,</div><div class="line">    med_rescue: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Medical Rescue&apos;</div><div class="line">    &#125;,</div><div class="line">    aquarescue: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Water Rescue&apos;</div><div class="line">    &#125;,</div><div class="line">    highangres: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;High Ang Rescue&apos;</div><div class="line">    &#125;,</div><div class="line">    hazcond: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Hazardous Conditions&apos;</div><div class="line">    &#125;,</div><div class="line">    airportres: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Airport Rescue&apos;</div><div class="line">    &#125;,</div><div class="line">    heavyres: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Heavy Rescue&apos;</div><div class="line">    &#125;,</div><div class="line">    pubsrvasst: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Public Service Assistance&apos;</div><div class="line">    &#125;,</div><div class="line">    falsealarm: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;false Alarm&apos;</div><div class="line">    &#125;,</div><div class="line">    hydbldinsp: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Hydro Building Inspection&apos;</div><div class="line">    &#125;,</div><div class="line">    investigat: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Investigation&apos;</div><div class="line">    &#125;,</div><div class="line">    h2o_safety: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Water Safety&apos;</div><div class="line">    &#125;,</div><div class="line">    chemdrop: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Chemicals Drop Off&apos;</div><div class="line">    &#125;,</div><div class="line">    smokedprog: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Smoke Detector Program&apos;</div><div class="line">    &#125;,</div><div class="line">    stntours: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Station Tours&apos;</div><div class="line">    &#125;,</div><div class="line">    sandwinter: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Sand Winter&apos;</div><div class="line">    &#125;,</div><div class="line">    bulkwater: &#123;</div><div class="line">      type: GraphQLBoolean,</div><div class="line">      description: &apos;Bulk Water&apos;</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>The <code>resolve</code> field again is a function, which is defined as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line">function resolvefireStations(rootValue, args )&#123;</div><div class="line">  return new Promise(function(resolve, reject) &#123;</div><div class="line">    var query = &apos;SELECT * from fire_stations WHERE 1=1&apos;</div><div class="line">    if(args.nameContains)&#123;</div><div class="line">      query += &apos; AND name like \&apos;%&apos;+args.nameContains+&apos;%\&apos;&apos;;</div><div class="line">    &#125;</div><div class="line">    if(args.addressContains)&#123;</div><div class="line">      query += &apos; AND address like \&apos;%&apos;+args.addressContains+&apos;%\&apos;&apos;;</div><div class="line">    &#125;</div><div class="line">    if(args.addressContains)&#123;</div><div class="line">      query += &apos; AND address like \&apos;%&apos;+args.addressContains+&apos;%\&apos;&apos;;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasFireSupport) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND FireSupp = &apos;+args.hasFireSupport;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasMedRescue) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND Med_Rescue = &apos;+args.hasMedRescue;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasAquaRescue) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND AquaRescue = &apos;+args.hasAquaRescue;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasHighAngRes) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND HighAngRes = &apos;+args.hasHighAngRes;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasHazCond) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND HazCond = &apos;+args.hasHazCond;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasAirportRes) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND AirportRes = &apos;+args.hasAirportRes;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasHeavyRes) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND HeavyRes = &apos;+args.hasHeavyRes;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasPubSrvAsst) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND PubSrvAsst = &apos;+args.hasPubSrvAsst;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasFalseAlarm) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND FalseAlarm = &apos;+args.hasFalseAlarm;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasHydBldInsp) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND HydBldInsp = &apos;+args.hasHydBldInsp;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasInvestigat) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND Investigat = &apos;+args.hasInvestigat;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasH20_Safety) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND H20_Safety = &apos;+args.hasH20_Safety;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasChemDrop) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND Chem_Drop = &apos;+args.hasChemDrop;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasSmokeDProg) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND SmokeDProg = &apos;+args.hasSmokeDProg;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasStnTours) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND StnTours = &apos;+args.hasStnTours;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasSandWinter) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND SandWinter = &apos;+args.hasSandWinter;</div><div class="line">    &#125;</div><div class="line">    if(typeof(args.hasBulkWater) === &apos;boolean&apos;)&#123;</div><div class="line">      query += &apos; AND BulkWater = &apos;+args.hasBulkWater;</div><div class="line">    &#125;</div><div class="line">    query += &apos;;&apos;;</div><div class="line">    db.connect(function(err, client, done) &#123;</div><div class="line">      if (err) &#123;reject(err);return;&#125;;</div><div class="line">      client</div><div class="line">        .query(query, function (err, result) &#123;</div><div class="line">          done();</div><div class="line">          if (err) &#123;reject(err);return;&#125;</div><div class="line">          resolve(result.rows);</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">  &#125;).then(function(res) &#123;</div><div class="line">    return res;</div><div class="line">  &#125;, function(error) &#123;</div><div class="line">    console.error(&quot;Database Error:&quot;, error);</div><div class="line">    return null;</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The <code>resolvefireStations</code> function builds a SQL query based on the arguments passed in the GraphQL query. The database is queried for the results, which are returned as a promise.</p>
<p>If you’d like to obtain a listing of all <a href="https://opendata-graphql.herokuapp.com/graphql?query=query%7B%0A%20%20fireStations%28hasChemDrop%3Atrue%29%7B%0A%20%20%20%20name%0A%20%20%20%20address%0A%20%20%7D%0A%7D" target="_blank" rel="external">Calgary fire stations with chemical drop off services</a>, you could run:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">query&#123;</div><div class="line">  fireStations(hasChemDrop:true)&#123;</div><div class="line">    name</div><div class="line">    address</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://www.louisbourque.ca/blog/blog/2016/09/graphql/" data-id="citg7fbmy0000sa09xy43bmf4" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      

    </footer>
  </div>
  
    
<ul id="article-nav" class="nav nav-pills nav-justified">
  
  <li role="presentation">
    <a href="/blog/2016/09/Developer-Business-Card/" id="article-nav-older" class="article-nav-link-wrap">
      <i class="fa fa-chevron-left pull-left"></i>
      <span class="article-nav-link-title">Free Developer Business Card</span>
    </a>
  </li>
  
  
</ul>


  
</article>




        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  <p><a href="http://www.louisbourque.ca/">Louis Bourque</a>'s blog on developing software for the web. Full of helpful tips and interesting facts. Let's learn together.</p>

</div>


  


  


  

  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/archives/2016/09/">September 2016</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/blog/archives/2016/08/">August 2016</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>



  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/blog/2016/09/graphql/">Calgary Open Data GraphQL API</a>
        </li>
      
        <li>
          <a href="/blog/2016/09/Developer-Business-Card/">Free Developer Business Card</a>
        </li>
      
        <li>
          <a href="/blog/2016/08/hello-world/">Hello World</a>
        </li>
      
    </ul>
  </div>



        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2016 Louis Bourque<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>



<script src="/blog/js/script.js"></script>

</body>
</html>
